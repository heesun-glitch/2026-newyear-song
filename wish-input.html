<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 새해 첫 곡 - 소원 입력</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J0W132F99N"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-J0W132F99N');
    </script>

    <style>
        /* CSS 디자인 유지 */
        body { margin: 0; padding: 0; background-color: #000000; height: 100vh; display: flex; justify-content: center; font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; color: white; overflow: hidden; }
        .container { width: 100%; max-width: 430px; height: 100%; background: linear-gradient(180deg, #1a1a1a 0%, #000000 30%); margin: 0 auto; position: relative; display: flex; flex-direction: column; padding: 0 20px; box-sizing: border-box; }
        .header { width: 100%; height: 80px; display: flex; align-items: center; margin-top: 10px; }
        .back-btn { background: none; border: none; cursor: pointer; padding: 10px 20px 10px 0; display: flex; align-items: center; }
        .back-btn img { width: 48px; height: 48px; display: block; }
        .title-area { margin-top: 10px; margin-bottom: 40px; }
        h2 { font-size: 28px; font-weight: 700; line-height: 1.4; margin: 0; }
        .highlight { color: #FFE173; }
        .input-wrapper { width: 100%; height: 150px; background-color: transparent; border-radius: 12px; padding: 20px; box-sizing: border-box; position: relative; transition: border-color 0.3s; border: 1px solid #555555; }
        .input-wrapper.filled { border: 1px solid #FFFFFF; }
        .input-wrapper:focus-within { border: 1px solid #FFE173; }
        textarea { width: 100%; height: 80%; background: transparent; border: none; resize: none; color: white; font-size: 16px; line-height: 1.5; font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; outline: none; }
        textarea::placeholder { color: #555555; }
        .char-count { position: absolute; bottom: 20px; right: 20px; font-size: 14px; color: #555555; }
        #currentCount { color: #555555; font-weight: 400; transition: color 0.3s; }
        .button-area { position: absolute; bottom: 40px; left: 0; width: 100%; padding: 0 20px; box-sizing: border-box; }
        .next-btn { width: 100%; padding: 18px 0; background-color: #FFE173; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; color: #000000; cursor: pointer; transition: opacity 0.3s; box-shadow: inset 0 6px 4px rgba(255, 255, 255, 0.25); }
        .next-btn:disabled { opacity: 0.3; cursor: not-allowed; box-shadow: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-btn" onclick="location.href='question.html'">
                <img src="arrow-left.svg" alt="뒤로가기">
            </button>
        </div>
        <div class="title-area">
            <h2 id="pageTitle"></h2>
        </div>
        <div class="input-wrapper" id="inputWrapper">
            <textarea id="wishInput" placeholder="" oninput="checkInput()"></textarea>
            <div class="char-count"><span id="currentCount">0</span>/30</div>
        </div>
        <div class="button-area">
            <button id="nextBtn" class="next-btn" disabled onclick="saveAndGo()">다음</button>
        </div>
    </div>

    <script>
        // [언어 감지]
        const isKorean = navigator.language.includes('ko');

        // [다국어 데이터]
        const i18n = {
            ko: {
                title: `새해 소원을<br><span class="highlight">한 문장</span>으로 적어주세요.`,
                placeholder: "새해 소원을 입력해 주세요.",
                btn: "다음"
            },
            en: {
                title: `Write your wish<br>in <span class="highlight">one sentence</span>.`,
                placeholder: "Please enter your wish.",
                btn: "Next"
            }
        };

        window.onload = function() {
            const lang = isKorean ? i18n.ko : i18n.en;
            
            // 텍스트 적용
            document.getElementById('pageTitle').innerHTML = lang.title;
            document.getElementById('wishInput').placeholder = lang.placeholder;
            document.getElementById('nextBtn').innerText = lang.btn;
        };

        function checkInput() {
            const input = document.getElementById('wishInput');
            const wrapper = document.getElementById('inputWrapper');
            const currentCountSpan = document.getElementById('currentCount');
            const nextBtn = document.getElementById('nextBtn');
            
            if (input.value.length > 30) {
                input.value = input.value.slice(0, 30);
            }
            const length = input.value.length;
            currentCountSpan.innerText = length;

            if (length > 0) {
                nextBtn.disabled = false;
                currentCountSpan.style.color = "#ffffff";
                wrapper.classList.add('filled'); 
            } else {
                nextBtn.disabled = true;
                currentCountSpan.style.color = "#555555";
                wrapper.classList.remove('filled');
            }
        }

        function saveAndGo() {
            const input = document.getElementById('wishInput');

            // [데이터 수집] 소원 입력 완료 이벤트 GA4 전송
            // (개인정보 보호를 위해 구체적인 텍스트 대신 '입력 완료' 사실만 보낼 수도 있지만, 
            // 여기서는 분석을 위해 길이 정보를 같이 보냅니다.)
            if (typeof gtag === 'function') {
                gtag('event', 'input_wish', {
                    'wish_length': input.value.length
                });
            }

            // 로컬 스토리지 저장
            localStorage.setItem('userWish', input.value);
            
            // 로딩 페이지로 이동
            location.href = 'loading.html';
        }
    </script>
</body>
</html>