<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 새해 첫 곡 - 소원 입력</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J0W132F99N"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-J0W132F99N');
    </script>
    <style>
        /* 수정: 스크롤 가능하게 overflow 제거 */
        body { margin: 0; padding: 0; background-color: #000000; min-height: 100vh; display: flex; justify-content: center; font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; color: white; }
        
        /* 수정: 하단 패딩 및 min-height 적용 */
        .container { width: 100%; max-width: 430px; min-height: 100vh; background: linear-gradient(180deg, rgba(255, 225, 115, 0.15) 0%, #1a1a1a 25%, #000000 50%); margin: 0 auto; position: relative; display: flex; flex-direction: column; padding: 0 20px 120px 20px; box-sizing: border-box; }
        
        .header { width: 100%; height: 80px; display: flex; align-items: center; margin-top: 10px; }
        .back-btn { background: none; border: none; cursor: pointer; padding: 10px 20px 10px 0; display: flex; align-items: center; }
        .back-btn img { width: 48px; height: 48px; display: block; }
        .title-area { margin-top: 10px; margin-bottom: 40px; }
        h2 { font-size: 28px; font-weight: 700; line-height: 1.4; margin: 0; }
        .highlight { color: #FFE173; }
        .input-wrapper { width: 100%; height: 150px; background-color: transparent; border-radius: 12px; padding: 20px; box-sizing: border-box; position: relative; transition: border-color 0.3s; border: 1px solid #555555; }
        .input-wrapper.filled { border: 1px solid #FFFFFF; }
        .input-wrapper:focus-within { border: 1px solid #FFE173; }
        textarea { width: 100%; height: 80%; background: transparent; border: none; resize: none; color: white; font-size: 16px; line-height: 1.5; font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; outline: none; }
        textarea::placeholder { color: #555555; }
        .char-count { position: absolute; bottom: 20px; right: 20px; font-size: 14px; color: #555555; }
        #currentCount { color: #555555; font-weight: 400; transition: color 0.3s; }
        
        /* 수정: 화면 하단 고정 (Fixed) */
        .button-area { 
            position: fixed; 
            bottom: 40px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 100%; 
            max-width: 430px; 
            padding: 0 20px; 
            box-sizing: border-box; 
            z-index: 999;
        }
        
        .next-btn { width: 100%; padding: 18px 0; background-color: #FFE173; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; color: #000000; cursor: pointer; transition: opacity 0.3s; box-shadow: inset 0 6px 4px rgba(255, 255, 255, 0.25); }
        .next-btn:disabled { opacity: 0.3; cursor: not-allowed; box-shadow: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><button class="back-btn" onclick="location.href='question.html'"><img src="arrow-left.svg" alt="뒤로가기"></button></div>
        <div class="title-area"><h2 id="pageTitle"></h2></div>
        <div class="input-wrapper" id="inputWrapper"><textarea id="wishInput" oninput="checkInput()"></textarea><div class="char-count"><span id="currentCount">0</span>/30</div></div>
        <div class="button-area"><button id="nextBtn" class="next-btn" disabled onclick="saveAndGo()">다음</button></div>
    </div>
    <script>
        const isKorean = navigator.language.includes('ko');
        const i18n = {
            ko: { title: `새해 소원을<br><span class="highlight">한 문장</span>으로 적어주세요.`, placeholder: "새해 소원을 입력해 주세요.", btn: "다음" },
            en: { title: `Write your wish<br>in <span class="highlight">one sentence</span>.`, placeholder: "Please enter your wish.", btn: "Next" }
        };

        window.onload = function() {
            const lang = isKorean ? i18n.ko : i18n.en;
            document.getElementById('pageTitle').innerHTML = lang.title;
            document.getElementById('wishInput').placeholder = lang.placeholder;
            document.getElementById('nextBtn').innerText = lang.btn;
        };

        function checkInput() {
            const input = document.getElementById('wishInput');
            const wrapper = document.getElementById('inputWrapper');
            const currentCountSpan = document.getElementById('currentCount');
            if (input.value.length > 30) { input.value = input.value.slice(0, 30); }
            const length = input.value.length;
            currentCountSpan.innerText = length;
            document.getElementById('nextBtn').disabled = length === 0;
            currentCountSpan.style.color = length > 0 ? "#ffffff" : "#555555";
            length > 0 ? wrapper.classList.add('filled') : wrapper.classList.remove('filled');
        }

        function saveAndGo() {
            const input = document.getElementById('wishInput');
            const savedKeyword = localStorage.getItem('userKeyword') || 'Unknown'; // 이전 페이지에서 저장한 키워드 불러오기

            // 1. GA4로 소원 데이터 전송 (가장 중요)
            if (typeof gtag === 'function') { 
                gtag('event', 'submit_wish', { 
                    'event_category': 'Input',
                    'user_keyword': savedKeyword, // 키워드와 소원을 묶어서 분석 가능
                    'user_wish': input.value 
                }); 
            }

            // 2. 소원 저장 및 이동
            localStorage.setItem('userWish', input.value);
            location.href = 'loading.html';
        }
    </script>
</body>
</html>